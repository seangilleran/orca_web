Note on megadoc transmutation: in theory we should be able to produce a Markdown file and have Pandoc handle everything from there. Unfortunately Pandoc runs out of memory way too quickly with the size of the files we're handling. So we end up running everything twice: first as Markdown, as a kind of plaintext fallback in case we need to do something with it later. Second as a .DOCX file, which is the format the PI is most used to working with the materials in. Doing this, especially linking back to images, is kind of a pain. It requires manipulating the document's underlying XML. Abandon all hope ye who enter that part of the code.